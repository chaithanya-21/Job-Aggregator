<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Job Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{font-family:Segoe UI;margin:0;background:#eef3f8}

.nav{
display:flex;gap:18px;padding:15px 25px;background:white;
box-shadow:0 2px 6px rgba(0,0,0,0.08)
}

.nav button{
border:none;background:none;font-size:14px;cursor:pointer
}

.tab{display:none;padding:25px}
.active{display:block}

.job{
background:white;border-radius:8px;padding:16px;margin-bottom:12px;
box-shadow:0 2px 6px rgba(0,0,0,0.08)
}

.title{font-weight:600;font-size:17px}
.small{font-size:13px;color:#555;margin-top:3px}

button.action{
margin-top:6px;padding:7px 11px;border:none;border-radius:5px;
background:#0a66c2;color:white;cursor:pointer
}

canvas{
max-width:300px!important;
max-height:220px!important;
margin:15px
}

.dashboard{
display:flex;
flex-wrap:wrap;
gap:20px
}
</style>
</head>

<body>

<div class="nav">
<button onclick="showTab('admin')">Admin</button>
<button onclick="showTab('jobs')">Available Jobs</button>
<button onclick="showTab('unapplied')">Unapplied Jobs</button>
<button onclick="showTab('applied')">Applied Jobs</button>
<button onclick="showTab('analytics')">Analytics</button>
<button onclick="showTab('chat')">ChatGPT</button>
</div>

<!-- ADMIN -->
<div id="admin" class="tab active">
<h2>Admin Panel</h2>
<button class="action" onclick="location.reload()">Refresh</button>
<p>Settings placeholder — can expand later.</p>
</div>

<!-- AVAILABLE JOBS -->
<div id="jobs" class="tab">
<h2>Available Jobs</h2>
<button class="action" onclick="loadJobs()">Refresh</button><br><br>

<label><b>Upload Resume File</b></label><br>
<input type="file" id="resumeFile" accept=".pdf"><br><br>

<div id="jobList"></div>
</div>

<!-- UNAPPLIED JOBS -->
<div id="unapplied" class="tab">
<h2>Unapplied Jobs</h2>
<button class="action" onclick="renderUnapplied()">Refresh</button>
<div id="unappliedList"></div>
</div>

<!-- APPLIED -->
<div id="applied" class="tab">
<h2>Applied Jobs</h2>
<button class="action" onclick="renderApplied()">Refresh</button>
<div id="appliedList"></div>
</div>

<!-- ANALYTICS -->
<div id="analytics" class="tab">
<h2>Analytics Dashboard</h2>
<button class="action" onclick="renderAnalytics()">Refresh</button>

<div class="dashboard">
<canvas id="c1"></canvas>
<canvas id="c2"></canvas>
<canvas id="c3"></canvas>
<canvas id="c4"></canvas>
<canvas id="c5"></canvas>
</div>
</div>

<!-- CHATGPT -->
<div id="chat" class="tab">
<h2>ChatGPT Assistant</h2>
<button class="action" onclick="location.reload()">Refresh</button><br><br>

<textarea id="chatInput" style="width:100%;height:90px"
placeholder="Ask anything about interview prep, resume, job strategy..."></textarea><br>
<button class="action" onclick="chat()">Ask ChatGPT</button>

<div id="chatOutput" style="margin-top:15px"></div>
</div>

<script>

/* TAB SWITCH */
function showTab(id){
document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
document.getElementById(id).classList.add('active');

if(id==="jobs") loadJobs();
if(id==="applied") renderApplied();
if(id==="unapplied") renderUnapplied();
if(id==="analytics") renderAnalytics();
}

/* LOAD JOBS */
async function loadJobs(){

const res=await fetch("/api/jobs");
const jobs=await res.json();

localStorage.setItem("allJobs",JSON.stringify(jobs));

jobList.innerHTML="";

jobs.forEach(j=>{
jobList.innerHTML+=createJobCard(j);
});

}

/* CREATE JOB CARD */
function createJobCard(j){

return `
<div class="job">

<div class="title">${j.title}</div>
<div class="small">${j.company}</div>
<div class="small">${j.location}</div>
<div class="small">Salary: ${j.salary}</div>
<div class="small"><b>Skills:</b> ${j.skills}</div>

<a href="${j.source}" target="_blank">
<button class="action">Apply</button>
</a>

<button class="action" onclick="markApplied('${j.title}','${j.company}')">
Mark Applied
</button>

</div>`;
}

/* MARK APPLIED */
function markApplied(title,company){
let a=JSON.parse(localStorage.getItem("applied")||"[]");
a.push({title,company});
localStorage.setItem("applied",JSON.stringify(a));
renderApplied();
}

/* RENDER APPLIED */
function renderApplied(){
let a=JSON.parse(localStorage.getItem("applied")||"[]");
appliedList.innerHTML="";
a.forEach((j,i)=>{
appliedList.innerHTML+=`
<div class="job">${j.title} - ${j.company}
<button class="action" onclick="unmark(${i})">Unmark</button>
</div>`;
});
}

/* UNMARK */
function unmark(i){
let a=JSON.parse(localStorage.getItem("applied")||"[]");
a.splice(i,1);
localStorage.setItem("applied",JSON.stringify(a));
renderApplied();
renderUnapplied();
}

/* UNAPPLIED LIST */
function renderUnapplied(){
let all=JSON.parse(localStorage.getItem("allJobs")||"[]");
let applied=JSON.parse(localStorage.getItem("applied")||"[]");

unappliedList.innerHTML="";

all.forEach(j=>{
const found=applied.find(a=>a.title===j.title && a.company===j.company);
if(!found) unappliedList.innerHTML+=createJobCard(j);
});
}

/* ANALYTICS DASHBOARD */
function renderAnalytics(){

let a=JSON.parse(localStorage.getItem("applied")||"[]");

new Chart(c1,{type:'doughnut',data:{labels:["Applied"],datasets:[{data:[a.length]}]}});
new Chart(c2,{type:'bar',data:{labels:a.map(x=>x.company),datasets:[{data:a.map(()=>1)}]}});
new Chart(c3,{type:'line',data:{labels:a.map((_,i)=>i+1),datasets:[{data:a.map((_,i)=>i+1)}]}});
new Chart(c4,{type:'pie',data:{labels:["Applied"],datasets:[{data:[a.length]}]}});
new Chart(c5,{type:'radar',data:{labels:["Consistency","Speed","Coverage"],datasets:[{data:[a.length,3,4]}]}});
}

/* CHATGPT PLACEHOLDER */
function chat(){
chatOutput.innerHTML="ChatGPT integration ready — connect API next.";
}

</script>

</body>
</html>
