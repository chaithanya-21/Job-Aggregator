<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Job Aggregator</title>

<style>
body{font-family:Segoe UI;background:#eef3f8;margin:0}
.container{max-width:900px;margin:auto;padding:30px}
.job{background:white;border-radius:8px;padding:18px;margin-bottom:14px;
box-shadow:0 2px 6px rgba(0,0,0,0.08)}
.title{font-weight:600;font-size:18px}
.small{font-size:14px;color:#555;margin-top:4px}
button{margin-top:8px;padding:8px 12px;border:none;border-radius:5px;background:#0a66c2;color:white}
</style>
</head>

<body>

<div class="container">

<h2>Upload Resume Once</h2>
<input type="file" id="resumeFile">

<hr>

<div id="jobs"></div>

</div>

<script>

let resumeText="";

document.getElementById("resumeFile").addEventListener("change", async e=>{
resumeText=await e.target.files[0].text();
});

async function loadJobs(){

const res=await fetch("/api/jobs");
const jobs=await res.json();

jobsDiv.innerHTML="";

jobs.forEach(j=>{

const card=document.createElement("div");
card.className="job";

card.innerHTML=`

<div class="title">${j.title}</div>
<div class="small">${j.company}</div>
<div class="small">${j.location}</div>
<div class="small">Salary: ${j.salary}</div>
<div class="small"><b>Skills Needed:</b> ${j.skills}</div>

<a href="${j.source}" target="_blank">Apply</a><br>

<button onclick="optimize('${encodeURIComponent(j.skills)}')">
Upload resume & Generate copy
</button>

<label>
<input type="checkbox"
onclick="logApplication('${j.title}','${j.company}','${j.location}','${j.salary}','${j.source}')">
Mark as Applied
</label>

`;

jobsDiv.appendChild(card);

});

}

function optimize(skillsEncoded){

if(!resumeText){
alert("Upload resume first");
return;
}

const skills=decodeURIComponent(skillsEncoded);
const optimized=resumeText+"\n\nRelevant Skills:\n"+skills;

const blob=new Blob([optimized],{type:"text/plain"});
const link=document.createElement("a");
link.href=URL.createObjectURL(blob);
link.download="optimized_resume.txt";
link.click();

}

async function logApplication(title,company,location,salary,link){

await fetch("/log-job",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({title,company,location,salary,link})
});

}

loadJobs();

</script>
</body>
</html>
