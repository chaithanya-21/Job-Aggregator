<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Job Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{font-family:Segoe UI;margin:0;background:#eef3f8}
.nav{display:flex;gap:20px;padding:15px 30px;background:white;
box-shadow:0 2px 6px rgba(0,0,0,0.08)}
.nav button{border:none;background:none;font-size:15px;cursor:pointer}
.tab{display:none;padding:30px}
.active{display:block}
.job{background:white;padding:15px;margin-bottom:10px;border-radius:6px}
</style>
</head>

<body>

<div class="nav">
<button onclick="showTab('admin')">Admin</button>
<button onclick="showTab('jobs')">Available Jobs</button>
<button onclick="showTab('applied')">Applied Jobs</button>
<button onclick="showTab('analytics')">Analytics</button>
<button onclick="showTab('custom')">Custom Analytics</button>
<button onclick="showTab('chat')">Interview Prep</button>
</div>

<!-- ADMIN -->
<div id="admin" class="tab active">
<h2>Admin Panel</h2>
<p>Edit settings from admin.html</p>
</div>

<!-- JOBS -->
<div id="jobs" class="tab">
<h2>Available Jobs</h2>
<div id="jobList"></div>
</div>

<!-- APPLIED -->
<div id="applied" class="tab">
<h2>Applied Jobs</h2>
<div id="appliedList"></div>
</div>

<!-- ANALYTICS -->
<div id="analytics" class="tab">
<h2>Application Analytics</h2>
<canvas id="chart1"></canvas>
</div>

<!-- CUSTOM ANALYTICS -->
<div id="custom" class="tab">
<h2>Custom Analytics</h2>
<p>Filter jobs by keyword:</p>
<input id="filterInput">
<button onclick="filterJobs()">Generate Report</button>
<div id="customResults"></div>
</div>

<!-- CHATGPT INTERVIEW -->
<div id="chat" class="tab">
<h2>Interview Practice</h2>
<select id="roleSelect">
<option>Business Analyst</option>
<option>Consultant</option>
<option>AI Engineer</option>
</select>
<button onclick="generateQuestions()">Generate Questions</button>
<ul id="questions"></ul>
</div>

<script>

function showTab(id){
document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
document.getElementById(id).classList.add('active');
}

/* Load jobs */
async function loadJobs(){
const res=await fetch("/api/jobs");
const jobs=await res.json();

jobList.innerHTML="";

jobs.forEach(j=>{
const div=document.createElement("div");
div.className="job";

div.innerHTML=`
<b>${j.title}</b><br>
${j.company}<br>
${j.location}<br>
<button onclick="markApplied('${j.title}','${j.company}')">
Mark Applied
</button>
`;

jobList.appendChild(div);
});
}

loadJobs();

/* Mark applied */
function markApplied(title,company){
let applied=JSON.parse(localStorage.getItem("applied")||"[]");
applied.push({title,company});
localStorage.setItem("applied",JSON.stringify(applied));
renderApplied();
renderAnalytics();
}

function renderApplied(){
let applied=JSON.parse(localStorage.getItem("applied")||"[]");
appliedList.innerHTML="";
applied.forEach(a=>{
appliedList.innerHTML+=`<div class="job">${a.title} - ${a.company}</div>`;
});
}
renderApplied();

/* Analytics */
function renderAnalytics(){
let applied=JSON.parse(localStorage.getItem("applied")||"[]").length;
let total=document.querySelectorAll("#jobList .job").length;

new Chart(chart1,{
type:'doughnut',
data:{
labels:["Applied","Remaining"],
datasets:[{data:[applied,total-applied]}]
}
});
}

/* Custom analytics */
function filterJobs(){
const keyword=filterInput.value.toLowerCase();
const jobs=document.querySelectorAll("#jobList .job");
customResults.innerHTML="";
jobs.forEach(j=>{
if(j.innerText.toLowerCase().includes(keyword))
customResults.appendChild(j.cloneNode(true));
});
}

/* Interview generator */
function generateQuestions(){
const role=roleSelect.value;
const list=[
`Tell me about your experience as a ${role}`,
`What tools do you use in ${role}?`,
`Describe a project you handled`
];
questions.innerHTML="";
list.forEach(q=>questions.innerHTML+=`<li>${q}</li>`);
}

</script>

</body>
</html>
