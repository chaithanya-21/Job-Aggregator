<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Job Aggregator</title>

<style>
body{font-family:Segoe UI;background:#eef3f8;margin:0}
.container{max-width:900px;margin:auto;padding:30px}
.job{background:white;border-radius:8px;padding:18px;margin-bottom:14px;
box-shadow:0 2px 6px rgba(0,0,0,0.08)}
.title{font-weight:600;font-size:18px}
.small{font-size:14px;color:#555;margin-top:4px}
button{margin-top:8px;padding:8px 12px;border:none;border-radius:5px;background:#0a66c2;color:white;cursor:pointer}
button:hover{background:#004182}
</style>
</head>

<body>

<div class="container">

<h2>Upload Resume Once</h2>
<input type="file" id="resumeFile">
<p id="status"></p>

<hr>

<div id="jobs"></div>

</div>

<script>

let resumeText="";

/* ðŸ”¹ Upload resume and store in memory */
document.getElementById("resumeFile").addEventListener("change", async e=>{
const file=e.target.files[0];
resumeText=await file.text();
document.getElementById("status").innerText="Resume uploaded successfully âœ”";
});

/* ðŸ”¹ Load jobs */
async function loadJobs(){

const res=await fetch("/api/jobs");
const jobs=await res.json();

jobsDiv.innerHTML="";

jobs.forEach(j=>{

const card=document.createElement("div");
card.className="job";

card.innerHTML=`

<div class="title">${j.title}</div>
<div class="small">${j.company}</div>
<div class="small">${j.location}</div>
<div class="small">Salary: ${j.salary}</div>
<div class="small"><b>Skills Needed:</b> ${j.skills}</div>

<br>

<a href="${j.source}" target="_blank">
<button>Apply to Job</button>
</a>

<button onclick="generateResume('${encodeURIComponent(j.skills)}')">
Generate Optimized Resume
</button>

<label style="margin-left:10px">
<input type="checkbox"> Mark as Applied
</label>

`;

jobsDiv.appendChild(card);

});

}

/* ðŸ”¹ Resume optimizer */
function generateResume(skillsEncoded){

if(!resumeText){
alert("Upload resume first");
return;
}

const skills=decodeURIComponent(skillsEncoded);
const optimized=resumeText+"\n\nRelevant Skills:\n"+skills;

const blob=new Blob([optimized],{type:"text/plain"});
const link=document.createElement("a");
link.href=URL.createObjectURL(blob);
link.download="optimized_resume.txt";
link.click();

}

loadJobs();

</script>

</body>
</html>
